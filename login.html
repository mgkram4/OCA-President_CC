<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sign in — OCA Cafeteria</title>
    <!-- Improved design: Google Fonts, SVG brand, glass card, refined controls -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
      :root{
        --bg-a:#eef6ff; --bg-b:#fbfdff; --card:rgba(255,255,255,0.85);
        --accent:linear-gradient(90deg,#0b6efd,#7cc7ff);
        --accent-color:#0b6efd; --muted:#6b7280; --glass:rgba(255,255,255,0.6);
      }
      *{box-sizing:border-box}
      html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,system-ui,-apple-system,Arial,sans-serif;background:radial-gradient(1200px 600px at 10% 10%, rgba(11,110,253,0.06), transparent), linear-gradient(180deg,var(--bg-a),var(--bg-b));color:#071033}
      main{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:40px}
      .layout{display:flex;gap:36px;align-items:center;width:100%;max-width:1100px}
      .brand-panel{flex:1;display:none;flex-direction:column;gap:18px}
      @media(min-width:960px){.brand-panel{display:flex}}
      .logo-wrap{width:96px;height:96px;border-radius:18px;background:linear-gradient(135deg,#0b6efd,#7cc7ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:26px;box-shadow:0 10px 30px rgba(11,110,253,0.12)}
      h2.brand-title{margin:0;font-size:20px}
      p.brand-desc{margin:0;color:var(--muted);max-width:360px}

      .card{
        width:100%;max-width:460px;padding:28px;border-radius:16px;background:var(--card);backdrop-filter:blur(6px) saturate(120%);box-shadow:0 30px 80px rgba(8,24,48,0.12);
      }
      h1{margin:0 0 6px 0;font-size:22px}
      p.lead{margin:0 0 12px 0;color:var(--muted)}

      form{display:flex;flex-direction:column;gap:12px}
      label{font-size:13px;color:#071033}
      input[type=text],input[type=password],select{padding:12px 14px;border-radius:12px;border:1px solid rgba(12,34,84,0.06);background:white;font-size:15px;transition:box-shadow .12s,border-color .12s}
      input:focus,select:focus{outline:none;border-color:rgba(11,110,253,0.35);box-shadow:0 8px 30px rgba(11,110,253,0.06)}

      .pw-row{display:flex;gap:10px}
      .pw-toggle{min-width:78px;padding:10px;border-radius:12px;border:1px solid rgba(12,34,84,0.06);background:#fbfdff;cursor:pointer}

      .strength{height:8px;border-radius:8px;background:#eef3ff;overflow:hidden}
      .strength > i{display:block;height:100%;width:0;background:linear-gradient(90deg,#fb7185,#f97316,#f59e0b,#10b981);transition:width .18s}

      .controls{display:flex;gap:12px}
      .btn{flex:1;padding:12px 14px;border-radius:12px;border:0;background:linear-gradient(90deg,#0b6efd,#3aa0ff);color:white;font-weight:700;cursor:pointer;box-shadow:0 8px 30px rgba(11,110,253,0.12);transition:transform .08s}
      .btn.secondary{background:transparent;border:1px solid rgba(11,110,253,0.12);color:var(--accent-color);box-shadow:none}
      .btn:active{transform:translateY(1px)}

      .helper{display:flex;align-items:center;justify-content:space-between;font-size:13px;color:var(--muted)}
      .status{font-size:14px;padding:10px;border-radius:10px;margin-top:8px}
      .status.error{background:rgba(239,68,68,0.06);color:#b91c1c}
      .status.success{background:rgba(16,185,129,0.06);color:#059669}

      .foot{text-align:center;margin-top:14px;color:var(--muted);font-size:13px}
    </style>
  </head>
  <body>
    <main>
      <div class="layout">
        <aside class="brand-panel" aria-hidden="true">
          <div class="logo-wrap">OCA</div>
          <h2 class="brand-title">OCA Cafeteria Tools</h2>
          <p class="brand-desc">A lightweight demo for managing menus, tracking plate waste and collecting student feedback. Sign in to access staff and admin tools.</p>
        </aside>

        <section class="card" aria-labelledby="authTitle">
          <h1 id="authTitle">Welcome back</h1>
          <p class="lead">Sign in to your account or create one for demo access.</p>

          <form id="authForm" autocomplete="on">
            <div>
              <label for="username">Username</label>
              <input id="username" name="username" type="text" required autocomplete="username" placeholder="e.g. alex.jones" />
            </div>

            <div>
              <label for="password">Password</label>
              <div class="pw-row">
                <input id="password" name="password" type="password" required autocomplete="current-password" placeholder="Enter password" />
                <button type="button" id="togglePw" class="pw-toggle" aria-pressed="false">Show</button>
              </div>
              <div class="strength" aria-hidden="true"><i id="pwBar"></i></div>
            </div>

            <div>
              <label for="role">Role</label>
              <select id="role" name="role" aria-label="Select role">
                <option value="student">Student</option>
                <option value="staff">Staff</option>
                <option value="admin">Admin</option>
              </select>
            </div>

            <div class="controls">
              <button id="signin" type="button" class="btn">Sign in</button>
              <button id="signup" type="button" class="btn secondary">Create</button>
            </div>

            <div class="helper">
              <label style="display:flex;gap:8px;align-items:center"><input id="remember" type="checkbox" /> Remember me</label>
              <a href="#" class="inline-link" id="forgot">Forgot password?</a>
            </div>

            <div id="status" class="status" role="status" aria-live="polite" style="display:none"></div>
            <small style="display:block;margin-top:8px;color:var(--muted)">Admin seeded: <code>admin</code> / <code>password</code>. This is a client-side demo only.</small>
          </form>

          <div class="foot">By continuing you agree to the demo terms. For production use a secure server-side auth solution.</div>
        </section>
      </div>
    </main>

    <script>
      // Demo client-side auth with improved UI
      const STORAGE_USERS = 'oca_users_v1'
      const STORAGE_SESSION = 'oca_session_v1'

      async function sha256(text){
        const enc = new TextEncoder();
        const data = enc.encode(text);
        const hash = await crypto.subtle.digest('SHA-256', data);
        return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
      }

      function loadUsers(){ try{ return JSON.parse(localStorage.getItem(STORAGE_USERS) || '[]') }catch(e){return []} }
      function saveUsers(list){ localStorage.setItem(STORAGE_USERS, JSON.stringify(list)) }
      function setSession(user, remember){
        const payload = {username:user.username,role:user.role,ts:Date.now()}
        if(remember) localStorage.setItem(STORAGE_SESSION, JSON.stringify(payload))
        else sessionStorage.setItem(STORAGE_SESSION, JSON.stringify(payload))
      }

      // UI refs
      const usernameEl = document.getElementById('username')
      const passwordEl = document.getElementById('password')
      const roleEl = document.getElementById('role')
      const statusEl = document.getElementById('status')
      const signinBtn = document.getElementById('signin')
      const signupBtn = document.getElementById('signup')
      const togglePw = document.getElementById('togglePw')
      const pwBar = document.getElementById('pwBar')

      // seed admin account if missing
      (async function seed(){
        const users = loadUsers();
        if(!users.find(u=>u.username==='admin')){
          const passHash = await sha256('password');
          users.push({username:'admin',role:'admin',password:passHash});
          saveUsers(users);
        }
      })();

      function showStatus(text,type){ statusEl.style.display='block'; statusEl.textContent=text; statusEl.className='status '+(type==='error'? 'error' : 'success') }
      function clearStatus(){ statusEl.style.display='none'; statusEl.textContent=''; statusEl.className='status' }

      // password toggle
      togglePw.addEventListener('click', ()=>{
        const is = passwordEl.type === 'password'
        passwordEl.type = is ? 'text' : 'password'
        togglePw.textContent = is ? 'Hide' : 'Show'
        togglePw.setAttribute('aria-pressed', String(is))
      })

      // strength meter
      passwordEl.addEventListener('input', ()=>{
        const s = passwordEl.value||''
        let score = 0
        if(s.length >= 8) score += 40
        if(/[A-Z]/.test(s)) score += 20
        if(/[0-9]/.test(s)) score += 20
        if(/[^A-Za-z0-9]/.test(s)) score += 20
        pwBar.style.width = Math.min(100,score) + '%'
      })

      signinBtn.addEventListener('click', async ()=>{
        clearStatus()
        const username = (usernameEl.value||'').trim()
        const password = passwordEl.value || ''
        const remember = document.getElementById('remember').checked
        if(!username || !password){ showStatus('Enter username and password','error'); return }
        const users = loadUsers()
        const user = users.find(u=>u.username===username)
        if(!user){ showStatus('User not found. You can create an account below.','error'); return }
        const passHash = await sha256(password)
        if(passHash !== user.password){ showStatus('Invalid credentials.','error'); return }
        setSession(user, remember)
        showStatus('Signed in — redirecting...', 'success')
        setTimeout(()=>{ window.location.href = (user.role === 'admin' ? 'admin.html' : '../index.html') }, 700)
      })

      signupBtn.addEventListener('click', async ()=>{
        clearStatus()
        const username = (usernameEl.value||'').trim()
        const password = passwordEl.value || ''
        const role = roleEl.value
        const remember = document.getElementById('remember').checked
        if(!username || !password){ showStatus('Enter username and password to create an account.','error'); return }
        const users = loadUsers()
        if(users.find(u=>u.username===username)){ showStatus('Username already exists. Choose another.','error'); return }
        const passHash = await sha256(password)
        const newUser = { username, role, password: passHash }
        users.push(newUser)
        saveUsers(users)
        setSession(newUser, remember)
        showStatus('Account created — redirecting...', 'success')
        setTimeout(()=>{ window.location.href = (role === 'admin' ? 'admin.html' : '../index.html') }, 700)
      })

      // keyboard: Enter triggers sign in
      document.getElementById('authForm').addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ e.preventDefault(); signinBtn.click() } })
    </script>
  </body>
</html>
